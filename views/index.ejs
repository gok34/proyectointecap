<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/main.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

  <link href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.1/css/bootstrap.min.css' rel='stylesheet'>
  <link href='https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap5.min.css' rel='stylesheet'>

  <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
  <script type="text/javascript" src="css/jquery.min.js"></script>
  <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
  
 

    <title>Proyecto Intecap</title>
  </head>
  <body>
      <div class="container">
    
    <h1 class="p-5 text-center ">USUARIOS</h1>
   <div><h2>Bienvenido  <strong></strong></h2> </div>
    
      <!--aqui empoeza la tabla de usuarios-->
      <div class="container">
        <div class="row" >
          <div class="col-md-10">
            <a href="/crear" class="btn btn-outline-primary mt-4"><i class='bx bx-plus-medical bx-md'></i></a>
          </div>
          <div class="col-md-2">
            <a href="/" class="btn btn-outline-primary mt-4"><i class='bx bxs-log-out bx-md'></i></a>
          </div>
        </div>
           
          
            <table id="usuarios" class="table table-bordered table-striped text-center mt-4" style="border: 1px;">
                <thead>
                 
<tr class="bg-primary text-white">
<th>ID</th>
<th >NOMBRE</th>
    <th >APELLIDOS</th>
    <th >TELEFONO</th>
    <th >DIRECION</th>
    <th >CORREO</th>
    <th >ROL</th>
  <th>PROCESOS</th>
</tr>
                </thead>
                <tbody> <!--
                  //forma con data en 
                    <% resultado.forEach(function(usuarios){ %>
<tr>
<td><%=usuarios.usuario_id %></td>
<td><%=usuarios.nombre %></td>
<td><%=usuarios.apellido %></td>
<td><%=usuarios.telefono %></td>
<td><%=usuarios.direcion %></td>
<td><%=usuarios.nombre_rol %></td>
<td><%=usuarios.correo %></td>
<td>
  <a href="/edit/<%=usuarios.usuario_id %>"><i class='bx bxs-edit-alt bx-md'></i></a>
 <!-- <a href="/eliminar/<%=usuarios.usuario_id %>" onclick="return confirm('¿Esta seguro que quiere borrar?')"><i class='bx bx-trash bx-md'></i></a>s
  <a  onclick="confirmar(<%=usuarios.usuario_id %>)"> <i class='bx bx-trash bx-md'></i></a>
</td>


</tr>
<% }) %>
---->


                </tbody>
            </table>

      </div>
      <!--aqui Termina la tabla de usuarios-->
    



</div>
    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.0/dist/sweetalert2.all.min.js"></script>
    
    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    -->
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap5.min.js"></script>
    <script>
//llamo la tabla sencillo/*
//$(document).ready(function() {
  //  $('#usuarios').DataTable();
//} );


//aqui empieza la nueva forma
$(document).ready(function() {
    $('#usuarios').DataTable({
ajax:{
  url:"/data",
  dataSrc:""
},
columns:[ 
  {data:"usuario_id"},
  {data:"nombre"},
  {data:"apellido"},
  {data:"telefono"},
  {data:"direcion"},
  {data:"correo"},
  {data:"nombre_rol"},
  {data:null,
  "render" : function (data){
return '<a href="/edit/'+data.usuario_id+'"><i class="bx bxs-edit-alt bx-md"></i></a>  <a  onclick="confirmar('+data.usuario_id+' )"> <i class="bx bx-trash bx-md"></i></a>'
  }
  }
],
lengthMenu: [ 10,20,30 ],
language: {
                "lengthMenu": "Mostrar _MENU_ registros",

                "zeroRecords": "No se encontraron resultados",
                "info": "Mostrando registros del _START_ al _END_ de _TOTAL_ registros",
                "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                "sSearch": "Buscar:",
                "oPaginate": {
                    "sFirst": "Primero",
                    "sLast":"Último",
                    "sNext":"Siguiente",
                    "sPrevious": "Anterior"
                },
                "sProcessing":"Procesando...",
            }


    });
} );

      function confirmar(id){
        Swal.fire({
  title: 'Desea eliminar este usuario?',
  icon:"warning",
  
  showCancelButton: true,
  confirmButtonText: `Confirmar`,
  denyButtonText: `Denegar`,
}).then((result) => {
  
  if (result.isConfirmed) {
   window.location='/eliminar/'+id;

  }
})
      }
     </script>

<script>
  var urlParams = new URLSearchParams(window.location.search);
  if(urlParams.has('success') && urlParams.get('success')){
  
  
    Swal.fire({
  position: 'top-begin',
  icon: 'success',
  title: 'Guardado Correctamente',
  confirmButtonText: `cancelar`,
  
  

}).then((result) => {

if (result.isConfirmed) {
  console.log(window.location.hostname)
    window.location.replace(window.location.origin + '/admin');

}
})



  
}
</script>

<% if(typeof alert!="undefined") { %>
  <script>
     Swal.fire({
title: '<%= alertTitle %>',
icon:'<%= alertIcon %>',
text:'<%= alertMesagge %>',
showConfirmButton:'<%= showConfirmButton %>',
confirmButtonText: `cancelar`,
timer:1500

}).then((result) => {

if (result.isConfirmed) {
 window.location='<%= ruta %>';

}
})

</script>
<% } %>


  </body>
</html>